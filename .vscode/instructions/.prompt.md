以下是你项目的**最终版本需求文档（完整版）**，采用 Markdown 格式，适合用作开发说明、团队协作、项目规划文档等。

---

# GLSL 案例库系统 · 项目需求文档

本项目是一个基于 **Next.js + Tailwind CSS + CodeMirror** 搭建的 Web 平台，旨在提供一个可在线编辑、实时渲染、输出验证的**GLSL 互动式案例库**，帮助用户系统学习与训练 Shader 编程。

---

## 一、核心目标

- 提供结构化、分类清晰的 GLSL 案例素材
- 支持用户在线编写 Shader 代码并实时渲染结果
- 提供参考输出与用户代码进行自动化像素对比验证
- 案例按目录分类管理，便于维护与扩展

---

## 二、功能模块设计

### 1. 案例展示与管理

- 案例以**目录结构划分分类**，自动生成标签
- 支持案例列表页浏览：

  - 分类列表
  - 按标签 / 难度 / 搜索关键词筛选

- 每个案例包含：

  - 标题、描述、技术标签、参考图像
  - 预设参考 GLSL 代码

### 2. 在线代码编辑器（CodeMirror）

- 支持 Fragment Shader、Vertex + Fragment 模式（仅前者为主）
- 提供：

  - GLSL 高亮、语法提示
  - 编辑区实时保存草稿
  - 按钮操作：运行代码 / 重置模板 / 查看参考答案
  - 自适应窗口大小与暗黑模式

### 3. WebGL 渲染预览区

- 使用 Canvas 实时渲染用户输入的 Shader 代码
- 支持传入常用 uniform：

  - `iResolution`
  - `iTime`
  - `iMouse`

- 渲染区域支持截图导出、画布重置等交互

### 4. 输出验证机制

- 每个案例对应一个参考图像（预渲染结果）
- 用户运行后的渲染结果与参考图进行**像素级比对**
- 比对方式：

  - 获取 Canvas 的 `ImageData`
  - 与参考图 `ImageData` 比较 RGB 误差
  - 返回相似度百分比 + 成功/失败状态

- 可视化差异热区（可选）

### 5. 用户交互控制区

- 运行代码（实时或点击触发）
- 提交验证（执行像素对比）
- 查看答案（加载参考代码）
- 重置编辑器
- 导出结果图像（可选）

---

## 三、技术栈选型

| 模块           | 技术说明                               |
| -------------- | -------------------------------------- |
| 主框架         | Next.js 14（App Router）               |
| UI 框架        | Tailwind CSS（原子化 CSS）             |
| 代码编辑器     | CodeMirror 6（GLSL 支持）              |
| 渲染引擎       | 原生 WebGL / Three.js ShaderMaterial   |
| 状态管理       | React Context / Zustand（轻量）        |
| 案例数据加载   | 基于文件系统，使用 `fs` 模块读取       |
| 像素级输出对比 | Canvas API + 自定义比对算法            |
| 静态资源       | `/data/` + `/public/reference-images/` |

---

## 四、数据组织结构

### 1. 案例目录结构（按分类）

```bash
data/
└── cases/
    ├── basic/
    │   ├── gradient.json
    │   └── uv-split.json
    ├── noise/
    │   ├── perlin.json
    │   └── fbm.json
    └── lighting/
        ├── phong.json
        └── toon.json
```

### 2. 单案例文件格式（`*.json`）

```json
{
  "id": "uv-split",
  "title": "UV分离效果",
  "description": "通过偏移 uv 实现颜色分离。",
  "difficulty": "easy",
  "fragment": "// fragment shader glsl code",
  "referenceImage": "/reference-images/basic/uv-split.png"
}
```

- **分类名**由所属目录推导：`basic`、`noise` 等
- **标签**、**封面图**可选字段（用于 UI 展示）

---

## 五、页面结构设计

### 首页（案例列表）

- 分类导航栏（目录自动生成）
- 案例卡片网格展示（封面图 + 标题）
- 搜索框 + 难度过滤器（本地过滤）

### 案例详情页 `/cases/[category]/[id]`

布局采用左右结构：

```
┌────────────────────────────────────┐
│ 标题 + 标签 + 描述                │
├────────────┬──────────────────────┤
│ 编辑器区域 │ WebGL 渲染区域       │
│（CodeMirror）│（Canvas 预览）        │
├────────────┴──────────────────────┤
│ 控制按钮区（运行 / 提交 / 查看答案）│
└────────────────────────────────────┘
```

---

## 六、关键交互流程

| 操作           | 系统行为                         |
| -------------- | -------------------------------- |
| 加载案例页面   | 自动加载对应 JSON 文件并渲染     |
| 修改 GLSL 代码 | 实时更新 Canvas 输出             |
| 点击“提交”按钮 | 获取输出图像，与参考图像对比     |
| 比对成功       | 提示 ✅ 成功，记录结果（可选）   |
| 查看答案       | 替换当前代码为参考代码，重新运行 |
