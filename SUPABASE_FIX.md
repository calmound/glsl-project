# ğŸš¨ Supabase è¯·æ±‚å¡ä½é—®é¢˜ - å¿«é€Ÿä¿®å¤æŒ‡å—

## é—®é¢˜ç°è±¡

```
https://fkgudvpbetdsjmtdpkge.supabase.co/rest/v1/user_form_code?on_conflict=user_id%2Cform_id
è¿™ä¸ªæ¥å£æ²¡æœ‰è¿”å›
```

åŒæ—¶çœ‹åˆ°æ—¥å¿—ï¼š
```
codeSource: 'ç»ƒä¹ ä»£ç '
hasServerInitialCode: false
```

## å¯èƒ½çš„åŸå› 

### 1. ç”¨æˆ·æœªç™»å½• â­ æœ€å¯èƒ½

ä»æ—¥å¿— `hasServerInitialCode: false` å¯ä»¥åˆ¤æ–­ï¼š
- æœåŠ¡ç«¯æ²¡æœ‰è·å–åˆ°ç”¨æˆ·ä»£ç 
- å¾ˆå¯èƒ½æ˜¯å› ä¸º**ç”¨æˆ·æ²¡æœ‰ç™»å½•**

### 2. è¯·æ±‚å¡ä½ï¼ˆæ¬¡è¦å¯èƒ½ï¼‰

å¯èƒ½åŸå› ï¼š
- ~~RLS ç­–ç•¥é—®é¢˜~~ (å·²æ£€æŸ¥ï¼Œç­–ç•¥æ­£å¸¸)
- `.select()` å¯¼è‡´é¢å¤–æŸ¥è¯¢ (å·²ç§»é™¤)
- ç½‘ç»œè¶…æ—¶

## å·²åº”ç”¨çš„ä¿®å¤

### âœ… ä¿®å¤ 1: ç§»é™¤ `.select()` å‡å°‘æŸ¥è¯¢è´Ÿæ‹…

**ä¿®æ”¹å‰**:
```typescript
const { data, error } = await supabase
  .from('user_form_code')
  .upsert(dataToSave, { onConflict: 'user_id,form_id' })
  .select();  // âŒ é¢å¤–çš„ SELECT æŸ¥è¯¢
```

**ä¿®æ”¹å**:
```typescript
const { error } = await supabase
  .from('user_form_code')
  .upsert(dataToSave, { 
    onConflict: 'user_id,form_id',
    ignoreDuplicates: false  // âœ… æ˜ç¡®å‚æ•°
  });  // âœ… ä¸éœ€è¦è¿”å›æ•°æ®
```

### âœ… ä¿®å¤ 2: æ·»åŠ è¯·æ±‚è®¡æ—¶

```typescript
const startTime = Date.now();
const { error } = await supabase.from('user_form_code').upsert(...);
const duration = Date.now() - startTime;
console.log(`ğŸ’¾ [å®¢æˆ·ç«¯] è¯·æ±‚è€—æ—¶: ${duration}ms`);
```

### âœ… ä¿®å¤ 3: å¢å¼ºé”™è¯¯æ—¥å¿—

ç°åœ¨ä¼šæ˜¾ç¤ºå®Œæ•´çš„é”™è¯¯ä¿¡æ¯ï¼š
```typescript
if (error) {
  console.error('âŒ [å®¢æˆ·ç«¯] ä¿å­˜å¤±è´¥:', {
    error,
    message: error.message,
    details: error.details,
    hint: error.hint,
    code: error.code
  });
}
```

## ğŸ” æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: è®¿é—®æµ‹è¯•é¡µé¢

è®¿é—®: **http://localhost:3000/test-supabase**

è¿™ä¸ªé¡µé¢ä¼šï¼š
- âœ… æµ‹è¯• Supabase å®¢æˆ·ç«¯åˆ›å»º
- âœ… æµ‹è¯•è®¤è¯çŠ¶æ€ï¼ˆæ˜¯å¦ç™»å½•ï¼‰
- âœ… æµ‹è¯•æ•°æ®åº“è¿æ¥
- âœ… æµ‹è¯•æ•°æ®ä¿å­˜åŠŸèƒ½

### æ­¥éª¤ 2: æ£€æŸ¥è®¤è¯çŠ¶æ€

å¦‚æœæµ‹è¯•é¡µé¢æ˜¾ç¤ºï¼š
```json
{
  "authCheck": {
    "success": true,
    "user": null  // âŒ è¿™é‡Œæ˜¯ null è¯´æ˜æœªç™»å½•
  }
}
```

**è§£å†³æ–¹æ¡ˆ**: 
1. ç‚¹å‡» "ç™»å½•" é“¾æ¥
2. ä½¿ç”¨ Google è´¦å·ç™»å½•
3. è¿”å›æµ‹è¯•é¡µé¢åˆ·æ–°

### æ­¥éª¤ 3: é‡æ–°æµ‹è¯•æ•™ç¨‹é¡µé¢

ç™»å½•åï¼Œè®¿é—®: **http://localhost:3000/learn/basic/basic-color-blend**

1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
2. ä¿®æ”¹ä»£ç 
3. è§‚å¯Ÿæ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ’¾ [å®¢æˆ·ç«¯] å¼€å§‹ä¿å­˜ä»£ç åˆ°æ•°æ®åº“...
ğŸ’¾ [å®¢æˆ·ç«¯] æ­£åœ¨è·å–ç”¨æˆ·ä¿¡æ¯...
ğŸ’¾ [å®¢æˆ·ç«¯] ç”¨æˆ·çŠ¶æ€: å·²ç™»å½• (xxx-xxx-xxx)
ğŸ’¾ [å®¢æˆ·ç«¯] å‡†å¤‡ä¿å­˜æ•°æ®: { formId: 'basic-color-blend', ... }
ğŸ’¾ [å®¢æˆ·ç«¯] å‘é€ upsert è¯·æ±‚...
ğŸ’¾ [å®¢æˆ·ç«¯] è¯·æ±‚è€—æ—¶: 200ms
âœ… [å®¢æˆ·ç«¯] ä»£ç ä¿å­˜æˆåŠŸ
```

4. åˆ·æ–°é¡µé¢ï¼Œæ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š

```
codeSource: 'æ•°æ®åº“'  // âœ… ç°åœ¨åº”è¯¥æ˜¯ä»æ•°æ®åº“åŠ è½½
hasServerInitialCode: true  // âœ…
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] è®¿é—® `/test-supabase` é¡µé¢
- [ ] ç¡®è®¤ "è®¤è¯çŠ¶æ€" æ˜¾ç¤ºå·²ç™»å½•
- [ ] ç¡®è®¤ "æ•°æ®åº“è¿æ¥" æµ‹è¯•é€šè¿‡
- [ ] ç¡®è®¤ "æ•°æ®ä¿å­˜æµ‹è¯•" æˆåŠŸ
- [ ] è®¿é—®æ•™ç¨‹é¡µé¢æµ‹è¯•å®é™…åŠŸèƒ½
- [ ] ä¿®æ”¹ä»£ç å¹¶ç­‰å¾…è‡ªåŠ¨ä¿å­˜
- [ ] åˆ·æ–°é¡µé¢éªŒè¯ä»£ç æ˜¯å¦è¢«åŠ è½½

## ğŸ› å¦‚æœè¿˜æ˜¯ä¸è¡Œ

### æ£€æŸ¥æµè§ˆå™¨ Network æ ‡ç­¾

1. æ‰“å¼€ DevTools â†’ Network æ ‡ç­¾
2. ä¿®æ”¹ä»£ç è§¦å‘ä¿å­˜
3. æŸ¥æ‰¾è¯·æ±‚åˆ° `user_form_code` çš„ POST/PATCH è¯·æ±‚
4. æ£€æŸ¥ï¼š
   - çŠ¶æ€ç ï¼ˆåº”è¯¥æ˜¯ 200 æˆ– 201ï¼‰
   - å“åº”æ—¶é—´ï¼ˆä¸åº”è¯¥è¶…è¿‡ 5 ç§’ï¼‰
   - å“åº”å†…å®¹
   - è¯·æ±‚ Headersï¼ˆæ£€æŸ¥ Authorization tokenï¼‰

### æ£€æŸ¥è¯·æ±‚è¯¦æƒ…

å¦‚æœè¯·æ±‚çŠ¶æ€æ˜¯ï¼š
- **Pending**: è¯·æ±‚å¡ä½äº†
  - å¯èƒ½åŸå› : ç½‘ç»œé—®é¢˜ã€CORSã€æœåŠ¡ç«¯æŒ‚èµ·
  - è§£å†³: æ£€æŸ¥ Supabase é¡¹ç›®çŠ¶æ€
  
- **401/403**: è®¤è¯/æˆæƒå¤±è´¥
  - åŸå› : æœªç™»å½•æˆ– token å¤±æ•ˆ
  - è§£å†³: é‡æ–°ç™»å½•
  
- **500**: æœåŠ¡å™¨é”™è¯¯
  - åŸå› : RLS ç­–ç•¥æˆ–è§¦å‘å™¨é”™è¯¯
  - è§£å†³: æ£€æŸ¥ Supabase æ—¥å¿—

### æŸ¥çœ‹ Supabase æ—¥å¿—

åœ¨ Supabase Dashboard:
1. é€‰æ‹©é¡¹ç›®
2. å·¦ä¾§èœå• â†’ Logs
3. é€‰æ‹© "Postgres Logs" æˆ– "API Logs"
4. æŸ¥æ‰¾ç›¸å…³æ—¶é—´çš„é”™è¯¯

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åçš„å®Œæ•´æµç¨‹ï¼š

1. **ç”¨æˆ·ç™»å½•** â†’ è·å¾—è®¤è¯ token
2. **ä¿®æ”¹ä»£ç ** â†’ è§¦å‘ 2 ç§’é˜²æŠ–
3. **è‡ªåŠ¨ä¿å­˜** â†’ è¯·æ±‚ 200-500ms å†…å®Œæˆ
4. **åˆ·æ–°é¡µé¢** â†’ æœåŠ¡ç«¯é¢„å–ä»£ç 
5. **åŠ è½½ä»£ç ** â†’ å®¢æˆ·ç«¯æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„ä»£ç 

---

**ç«‹å³è¡ŒåŠ¨**: è®¿é—® http://localhost:3000/test-supabase å¼€å§‹æµ‹è¯•ï¼
