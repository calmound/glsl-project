# GLSL å­¦ä¹ å¹³å° v2 æ”¹è¿›è®¡åˆ’

**é¡¹ç›®**: GLSL å­¦ä¹ å¹³å°
**ç‰ˆæœ¬**: v2.0
**åˆ›å»ºæ—¶é—´**: 2025-12-03
**æœ€åæ›´æ–°**: 2025-12-03
**çŠ¶æ€**: è§„åˆ’ä¸­

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®å®Œæ•´æ€§æ”¹è¿›](#æ•°æ®å®Œæ•´æ€§æ”¹è¿›)
2. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
3. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–](#ç”¨æˆ·ä½“éªŒä¼˜åŒ–)
4. [ä»£ç è´¨é‡æ”¹è¿›](#ä»£ç è´¨é‡æ”¹è¿›)
5. [å®‰å…¨æ€§å¢å¼º](#å®‰å…¨æ€§å¢å¼º)
6. [åŠŸèƒ½å¢å¼º](#åŠŸèƒ½å¢å¼º)
7. [ç›‘æ§ä¸åˆ†æ](#ç›‘æ§ä¸åˆ†æ)
8. [UI/UX æ”¹è¿›](#uiux-æ”¹è¿›)

---

## âœ… æ•°æ®å®Œæ•´æ€§æ”¹è¿›

### 1.1 æ·»åŠ å”¯ä¸€çº¦æŸï¼ˆå·²å®Œæˆï¼‰

**é—®é¢˜æè¿°**:
- `user_form_code` è¡¨ç¼ºå°‘ `UNIQUE(user_id, form_id)` çº¦æŸ
- `user_form_status` è¡¨ç¼ºå°‘ `UNIQUE(user_id, form_id)` çº¦æŸ
- å¯èƒ½å¯¼è‡´åŒä¸€ç”¨æˆ·å¯¹åŒä¸€æ•™ç¨‹äº§ç”Ÿå¤šæ¡é‡å¤è®°å½•

**è§£å†³æ–¹æ¡ˆ**:
```sql
-- å·²åº”ç”¨çš„è¿ç§»: add_unique_constraints_to_user_tables
ALTER TABLE user_form_code
  ADD CONSTRAINT user_form_code_user_form_unique
  UNIQUE (user_id, form_id);

ALTER TABLE user_form_status
  ADD CONSTRAINT user_form_status_user_form_unique
  UNIQUE (user_id, form_id);
```

**å½±å“**:
- âœ… é˜²æ­¢æ•°æ®é‡å¤
- âœ… æé«˜æ•°æ®ä¸€è‡´æ€§
- âœ… ç®€åŒ–æŸ¥è¯¢é€»è¾‘ï¼ˆæ— éœ€ DISTINCTï¼‰

**è¿ç§»ç‰ˆæœ¬**: 20251203160201
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 2.1 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**å½“å‰é—®é¢˜**:
- æ•™ç¨‹åˆ—è¡¨åŠ è½½å¯èƒ½è¾ƒæ…¢ï¼ˆéœ€è¦è¯»å–æ‰€æœ‰ config.json æ–‡ä»¶ï¼‰
- ç”¨æˆ·è¿›åº¦ç»Ÿè®¡éœ€è¦å¤šæ¬¡æ•°æ®åº“æŸ¥è¯¢

**ä¼˜åŒ–æ–¹æ¡ˆ**:

#### 2.1.1 æ·»åŠ æ•™ç¨‹å…ƒæ•°æ®ç¼“å­˜è¡¨
```sql
CREATE TABLE tutorial_metadata (
  id TEXT PRIMARY KEY,
  category TEXT NOT NULL,
  title_en TEXT NOT NULL,
  title_zh TEXT NOT NULL,
  description_en TEXT,
  description_zh TEXT,
  difficulty TEXT NOT NULL,
  estimated_time INTEGER,
  tags TEXT[],
  is_premium BOOLEAN DEFAULT FALSE,
  prerequisites TEXT[],
  order_index INTEGER,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç´¢å¼•
CREATE INDEX idx_tutorial_metadata_category ON tutorial_metadata(category);
CREATE INDEX idx_tutorial_metadata_difficulty ON tutorial_metadata(difficulty);
CREATE INDEX idx_tutorial_metadata_is_premium ON tutorial_metadata(is_premium);

-- RLS
ALTER TABLE tutorial_metadata ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Tutorial metadata is publicly readable"
  ON tutorial_metadata FOR SELECT
  USING (true);
```

**ä¼˜ç‚¹**:
- âœ… å‡å°‘æ–‡ä»¶ç³»ç»Ÿè¯»å–
- âœ… åŠ å¿«æ•™ç¨‹åˆ—è¡¨åŠ è½½
- âœ… æ”¯æŒé«˜çº§æœç´¢å’Œè¿‡æ»¤
- âœ… ä¾¿äºç»Ÿè®¡å’Œåˆ†æ

**çŠ¶æ€**: â³ å¾…å®æ–½

---

#### 2.1.2 æ·»åŠ ç”¨æˆ·è¿›åº¦æ±‡æ€»è§†å›¾
```sql
CREATE VIEW user_progress_summary AS
SELECT
  ufs.user_id,
  COUNT(*) AS total_tutorials,
  SUM(CASE WHEN ufs.is_passed THEN 1 ELSE 0 END) AS passed_count,
  SUM(CASE WHEN ufs.has_submitted THEN 1 ELSE 0 END) AS submitted_count,
  SUM(ufs.attempts) AS total_attempts,
  ROUND(
    100.0 * SUM(CASE WHEN ufs.is_passed THEN 1 ELSE 0 END) / COUNT(*),
    2
  ) AS completion_percentage
FROM user_form_status ufs
GROUP BY ufs.user_id;

-- æˆæƒ
GRANT SELECT ON user_progress_summary TO authenticated;
```

**ä¼˜ç‚¹**:
- âœ… å¿«é€Ÿè·å–ç”¨æˆ·è¿›åº¦ç»Ÿè®¡
- âœ… å‡å°‘å®¢æˆ·ç«¯è®¡ç®—
- âœ… ç»Ÿä¸€çš„è¿›åº¦è®¡ç®—é€»è¾‘

**çŠ¶æ€**: â³ å¾…å®æ–½

---

### 2.2 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### 2.2.1 ä»£ç ç¼–è¾‘å™¨ä¼˜åŒ–
**é—®é¢˜**:
- æ¯ 2 ç§’è‡ªåŠ¨ä¿å­˜å¯èƒ½è¿‡äºé¢‘ç¹
- å¯èƒ½åœ¨ç”¨æˆ·è¾“å…¥æ—¶é€ æˆå¡é¡¿

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```typescript
// src/app/[locale]/learn/[category]/[id]/tutorial-client.tsx

// å½“å‰: 2ç§’ debounce
const debouncedSave = useMemo(
  () =>
    debounce(async (code: string) => {
      // ä¿å­˜é€»è¾‘
    }, 2000),
  []
);

// ä¼˜åŒ–å: 5ç§’ debounceï¼Œå¹¶åœ¨ç”¨æˆ·ç¦»å¼€ç¼–è¾‘å™¨æ—¶ç«‹å³ä¿å­˜
const debouncedSave = useMemo(
  () =>
    debounce(async (code: string) => {
      // ä¿å­˜é€»è¾‘
    }, 5000), // å¢åŠ åˆ° 5 ç§’
  []
);

// æ·»åŠ  onBlur äº‹ä»¶ç«‹å³ä¿å­˜
const handleEditorBlur = () => {
  debouncedSave.flush(); // ç«‹å³æ‰§è¡Œä¿å­˜
};
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

#### 2.2.2 Shader ç¼–è¯‘ä¼˜åŒ–
**é—®é¢˜**:
- æ¯æ¬¡ä»£ç æ›´æ”¹éƒ½ä¼šé‡æ–°ç¼–è¯‘ shader
- å¯èƒ½é€ æˆæ€§èƒ½é—®é¢˜

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```typescript
// æ·»åŠ ç¼–è¯‘é”™è¯¯æ£€æµ‹ï¼Œé¿å…åå¤ç¼–è¯‘æ— æ•ˆä»£ç 
const [lastValidCode, setLastValidCode] = useState<string>('');
const [compileError, setCompileError] = useState<string | null>(null);

const handleCodeChange = (newCode: string) => {
  setCode(newCode);

  // å¦‚æœä¸Šæ¬¡ç¼–è¯‘å¤±è´¥ï¼Œå»¶è¿Ÿç¼–è¯‘
  if (compileError) {
    debouncedCompile(newCode);
  } else {
    compileShader(newCode);
  }
};
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## ğŸ’¡ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 3.1 æ•™ç¨‹è¿›åº¦å¯è§†åŒ–

**éœ€æ±‚**:
- åœ¨æ•™ç¨‹åˆ—è¡¨é¡µæ˜¾ç¤ºæ¯ä¸ªæ•™ç¨‹çš„å®ŒæˆçŠ¶æ€
- æ˜¾ç¤ºæ•´ä½“å­¦ä¹ è¿›åº¦

**å®ç°æ–¹æ¡ˆ**:

#### 3.1.1 æ•™ç¨‹å¡ç‰‡çŠ¶æ€æ ‡è¯†
```tsx
// src/components/common/tutorial-card.tsx
<div className="relative">
  {userProgress?.is_passed && (
    <div className="absolute top-2 right-2 bg-green-500 text-white rounded-full p-2">
      <CheckIcon className="w-4 h-4" />
    </div>
  )}
  {userProgress?.has_submitted && !userProgress?.is_passed && (
    <div className="absolute top-2 right-2 bg-yellow-500 text-white rounded-full p-2">
      <ClockIcon className="w-4 h-4" />
    </div>
  )}
  {/* æ•™ç¨‹å†…å®¹ */}
</div>
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

#### 3.1.2 å­¦ä¹ è·¯å¾„å¯è§†åŒ–
```tsx
// src/components/learn/learning-path.tsx
export function LearningPath({ category, tutorials, userProgress }) {
  return (
    <div className="flex flex-col space-y-4">
      {tutorials.map((tutorial, index) => (
        <div key={tutorial.id} className="flex items-center">
          {/* æ•™ç¨‹èŠ‚ç‚¹ */}
          <div className={`
            w-8 h-8 rounded-full flex items-center justify-center
            ${userProgress[tutorial.id]?.is_passed ? 'bg-green-500' : 'bg-gray-300'}
          `}>
            {index + 1}
          </div>

          {/* è¿æ¥çº¿ */}
          {index < tutorials.length - 1 && (
            <div className="w-1 h-12 bg-gray-300 ml-4" />
          )}
        </div>
      ))}
    </div>
  );
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

### 3.2 é”™è¯¯æç¤ºæ”¹è¿›

**é—®é¢˜**:
- Shader ç¼–è¯‘é”™è¯¯æç¤ºä¸å¤Ÿå‹å¥½
- ç”¨æˆ·éš¾ä»¥ç†è§£é”™è¯¯åŸå› 

**ä¼˜åŒ–æ–¹æ¡ˆ**:

#### 3.2.1 å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
```typescript
// src/lib/shader-error-parser.ts
const ERROR_MESSAGES = {
  'undeclared identifier': {
    zh: 'æœªå£°æ˜çš„å˜é‡æˆ–å‡½æ•°',
    en: 'Undeclared variable or function',
    hint: {
      zh: 'æ£€æŸ¥å˜é‡åæ˜¯å¦æ‹¼å†™æ­£ç¡®ï¼Œæˆ–è€…æ˜¯å¦å¿˜è®°å£°æ˜',
      en: 'Check if the variable name is spelled correctly or if you forgot to declare it'
    }
  },
  'syntax error': {
    zh: 'è¯­æ³•é”™è¯¯',
    en: 'Syntax error',
    hint: {
      zh: 'æ£€æŸ¥æ˜¯å¦ç¼ºå°‘åˆ†å·ã€æ‹¬å·æˆ–å…¶ä»–ç¬¦å·',
      en: 'Check for missing semicolons, brackets, or other symbols'
    }
  },
  // æ›´å¤šé”™è¯¯ç±»å‹...
};

export function parseShaderError(error: string, locale: string) {
  for (const [pattern, message] of Object.entries(ERROR_MESSAGES)) {
    if (error.includes(pattern)) {
      return {
        title: message[locale],
        hint: message.hint[locale],
        raw: error
      };
    }
  }

  return { title: error, hint: null, raw: error };
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

### 3.3 ä»£ç ç¤ºä¾‹å¿«é€Ÿæ’å…¥

**éœ€æ±‚**:
- æä¾›å¸¸ç”¨ä»£ç ç‰‡æ®µå¿«é€Ÿæ’å…¥
- å‡å°‘é‡å¤ä»£ç è¾“å…¥

**å®ç°æ–¹æ¡ˆ**:

#### 3.3.1 ä»£ç ç‰‡æ®µåº“
```typescript
// src/lib/code-snippets.ts
export const GLSL_SNIPPETS = {
  basic: [
    {
      id: 'main-function',
      title: { zh: 'ä¸»å‡½æ•°', en: 'Main Function' },
      code: `void main() {
  vec2 uv = gl_FragCoord.xy / u_resolution;
  gl_FragColor = vec4(uv, 0.0, 1.0);
}`
    },
    {
      id: 'circle',
      title: { zh: 'åœ†å½¢', en: 'Circle' },
      code: `float circle(vec2 st, float radius) {
  return step(radius, length(st - 0.5));
}`
    }
  ],
  patterns: [
    // å›¾æ¡ˆç›¸å…³çš„ä»£ç ç‰‡æ®µ
  ],
  noise: [
    // å™ªå£°ç›¸å…³çš„ä»£ç ç‰‡æ®µ
  ]
};
```

#### 3.3.2 ç‰‡æ®µé€‰æ‹©å™¨ UI
```tsx
// src/components/common/snippet-selector.tsx
export function SnippetSelector({ category, onInsert, locale }) {
  const snippets = GLSL_SNIPPETS[category] || [];

  return (
    <div className="snippet-selector">
      <h3>{locale === 'zh' ? 'ä»£ç ç‰‡æ®µ' : 'Code Snippets'}</h3>
      <div className="grid grid-cols-2 gap-2">
        {snippets.map(snippet => (
          <button
            key={snippet.id}
            onClick={() => onInsert(snippet.code)}
            className="p-2 border rounded hover:bg-gray-100"
          >
            {snippet.title[locale]}
          </button>
        ))}
      </div>
    </div>
  );
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## ğŸ”§ ä»£ç è´¨é‡æ”¹è¿›

### 4.1 ç±»å‹å®‰å…¨å¢å¼º

**é—®é¢˜**:
- éƒ¨åˆ†ä»£ç ä½¿ç”¨ `any` ç±»å‹
- ç¼ºå°‘ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥

**æ”¹è¿›æ–¹æ¡ˆ**:

#### 4.1.1 å®šä¹‰å®Œæ•´çš„ç±»å‹
```typescript
// src/types/tutorial.ts
export interface TutorialConfig {
  id: string;
  title: LocalizedString;
  description: LocalizedString;
  difficulty: 'beginner' | 'intermediate' | 'advanced';
  category: string;
  tags: string[];
  estimatedTime: number;
  prerequisites?: string[];
  learningObjectives: LocalizedStringArray;
  uniforms: Record<string, number | number[]>;
  isPremium?: boolean;
}

export interface UserProgress {
  user_id: string;
  form_id: string;
  has_submitted: boolean;
  is_passed: boolean;
  attempts: number;
  last_submitted_at: string | null;
  first_passed_at: string | null;
  last_result: ValidationResult | null;
}

export interface ValidationResult {
  passed: boolean;
  message: string;
  errors?: string[];
}

export type LocalizedString = {
  zh: string;
  en: string;
};

export type LocalizedStringArray = {
  zh: string[];
  en: string[];
};
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

#### 4.1.2 å¯ç”¨ä¸¥æ ¼çš„ TypeScript é…ç½®
```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

### 4.2 é”™è¯¯å¤„ç†æ”¹è¿›

**é—®é¢˜**:
- ç¼ºå°‘ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- é”™è¯¯æ—¥å¿—ä¸å¤Ÿè¯¦ç»†

**æ”¹è¿›æ–¹æ¡ˆ**:

#### 4.2.1 ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å·¥å…·
```typescript
// src/lib/error-handler.ts
export class AppError extends Error {
  constructor(
    public code: string,
    message: string,
    public statusCode: number = 500,
    public details?: any
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export async function handleApiError(error: unknown) {
  if (error instanceof AppError) {
    console.error(`[${error.code}] ${error.message}`, error.details);
    return {
      error: {
        code: error.code,
        message: error.message,
        details: error.details
      },
      status: error.statusCode
    };
  }

  console.error('Unexpected error:', error);
  return {
    error: {
      code: 'INTERNAL_ERROR',
      message: 'An unexpected error occurred'
    },
    status: 500
  };
}
```

#### 4.2.2 API è·¯ç”±é”™è¯¯å¤„ç†
```typescript
// src/app/api/shader/[category]/[id]/route.ts
export async function GET(request: Request) {
  try {
    // ... ä¸šåŠ¡é€»è¾‘
  } catch (error) {
    const { error: errorResponse, status } = await handleApiError(error);
    return NextResponse.json(errorResponse, { status });
  }
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## ğŸ”’ å®‰å…¨æ€§å¢å¼º

### 5.1 å¯†ç å®‰å…¨ç­–ç•¥ï¼ˆå»ºè®®ï¼‰

**å½“å‰çŠ¶æ€**:
- Supabase æ³„éœ²å¯†ç ä¿æŠ¤åŠŸèƒ½æœªå¯ç”¨

**å»ºè®®æ“ä½œ**:
1. å‰å¾€ Supabase Dashboard â†’ Authentication â†’ Policies
2. å¯ç”¨ "Leaked Password Protection"
3. æ–‡æ¡£ï¼šhttps://supabase.com/docs/guides/auth/password-security

**ä¼˜ç‚¹**:
- âœ… é˜²æ­¢ç”¨æˆ·ä½¿ç”¨å·²æ³„éœ²çš„å¯†ç 
- âœ… æé«˜è´¦æˆ·å®‰å…¨æ€§
- âœ… ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ

**çŠ¶æ€**: â³ å¾…é…ç½®

---

### 5.2 å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)

**éœ€æ±‚**:
- æ·»åŠ  Content Security Policy å¤´éƒ¨
- é˜²æ­¢ XSS æ”»å‡»

**å®ç°æ–¹æ¡ˆ**:
```typescript
// next.config.ts
const nextConfig = {
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'Content-Security-Policy',
            value: [
              "default-src 'self'",
              "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com",
              "style-src 'self' 'unsafe-inline'",
              "img-src 'self' data: https:",
              "font-src 'self' data:",
              "connect-src 'self' https://*.supabase.co",
              "frame-src 'self'"
            ].join('; ')
          },
          {
            key: 'X-Frame-Options',
            value: 'DENY'
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff'
          },
          {
            key: 'Referrer-Policy',
            value: 'origin-when-cross-origin'
          }
        ]
      }
    ];
  }
};
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

### 5.3 é€Ÿç‡é™åˆ¶

**éœ€æ±‚**:
- é˜²æ­¢ API æ»¥ç”¨
- é™åˆ¶ä»£ç æäº¤é¢‘ç‡

**å®ç°æ–¹æ¡ˆ**:
```typescript
// src/lib/rate-limiter.ts
import { Redis } from '@upstash/redis';

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_URL!,
  token: process.env.UPSTASH_REDIS_TOKEN!
});

export async function rateLimit(
  identifier: string,
  limit: number = 10,
  window: number = 60
): Promise<{ success: boolean; remaining: number }> {
  const key = `rate-limit:${identifier}`;
  const current = await redis.incr(key);

  if (current === 1) {
    await redis.expire(key, window);
  }

  return {
    success: current <= limit,
    remaining: Math.max(0, limit - current)
  };
}

// ä½¿ç”¨ç¤ºä¾‹
export async function POST(request: Request) {
  const user = await getUser();
  const { success, remaining } = await rateLimit(user.id, 30, 60);

  if (!success) {
    return NextResponse.json(
      { error: 'Too many requests' },
      {
        status: 429,
        headers: { 'X-RateLimit-Remaining': remaining.toString() }
      }
    );
  }

  // å¤„ç†è¯·æ±‚...
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## â­ åŠŸèƒ½å¢å¼º

### 6.1 æ•™ç¨‹æœç´¢åŠŸèƒ½

**éœ€æ±‚**:
- æ”¯æŒæŒ‰æ ‡é¢˜ã€æ ‡ç­¾ã€éš¾åº¦æœç´¢æ•™ç¨‹
- æ”¯æŒå…¨æ–‡æœç´¢

**å®ç°æ–¹æ¡ˆ**:

#### 6.1.1 å‰ç«¯æœç´¢ç»„ä»¶
```tsx
// src/components/learn/tutorial-search.tsx
export function TutorialSearch({ locale, onSearch }) {
  const [query, setQuery] = useState('');
  const [filters, setFilters] = useState({
    difficulty: [],
    category: [],
    tags: []
  });

  return (
    <div className="search-container">
      <input
        type="text"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder={locale === 'zh' ? 'æœç´¢æ•™ç¨‹...' : 'Search tutorials...'}
        className="w-full p-2 border rounded"
      />

      {/* è¿‡æ»¤å™¨ */}
      <div className="filters mt-4">
        <FilterGroup
          title={locale === 'zh' ? 'éš¾åº¦' : 'Difficulty'}
          options={['beginner', 'intermediate', 'advanced']}
          selected={filters.difficulty}
          onChange={(v) => setFilters({ ...filters, difficulty: v })}
        />
        {/* æ›´å¤šè¿‡æ»¤å™¨... */}
      </div>
    </div>
  );
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## ğŸ“Š ç›‘æ§ä¸åˆ†æ

### 7.1 é”™è¯¯è¿½è¸ª

**éœ€æ±‚**:
- è®°å½•å¸¸è§çš„ç¼–è¯‘é”™è¯¯
- å¸®åŠ©æ”¹è¿›æ•™ç¨‹å†…å®¹

**å®ç°æ–¹æ¡ˆ**:

#### 7.1.1 é”™è¯¯æ—¥å¿—è¡¨
```sql
CREATE TABLE shader_errors (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  tutorial_id TEXT NOT NULL,
  error_type TEXT NOT NULL,
  error_message TEXT NOT NULL,
  code_snippet TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_shader_errors_tutorial_id ON shader_errors(tutorial_id);
CREATE INDEX idx_shader_errors_error_type ON shader_errors(error_type);
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## ğŸ¨ UI/UX æ”¹è¿›

### 8.1 å“åº”å¼è®¾è®¡ä¼˜åŒ–

**é—®é¢˜**:
- ç§»åŠ¨ç«¯ä»£ç ç¼–è¾‘å™¨ä½“éªŒä¸ä½³
- Shader é¢„è§ˆåœ¨å°å±å¹•ä¸Šæ˜¾ç¤ºä¸å®Œæ•´

**æ”¹è¿›æ–¹æ¡ˆ**:
```tsx
// src/components/common/shader-editor.tsx
export function ShaderEditor({ locale }) {
  const [layout, setLayout] = useState<'horizontal' | 'vertical'>('horizontal');
  const isMobile = useMediaQuery('(max-width: 768px)');

  useEffect(() => {
    setLayout(isMobile ? 'vertical' : 'horizontal');
  }, [isMobile]);

  return (
    <div className={layout === 'vertical' ? 'flex-col' : 'flex-row'}>
      <ShaderCanvas />
      <CodeEditor />
    </div>
  );
}
```

**çŠ¶æ€**: â³ å¾…å®æ–½

---

## ğŸ—“ï¸ å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®å®Œæ•´æ€§ï¼ˆå·²å®Œæˆï¼‰
- âœ… æ·»åŠ  UNIQUE çº¦æŸ

### Phase 2: æ€§èƒ½ä¼˜åŒ–ï¼ˆ2-3 å‘¨ï¼‰
- [ ] åˆ›å»ºæ•™ç¨‹å…ƒæ•°æ®ç¼“å­˜è¡¨
- [ ] åˆ›å»ºç”¨æˆ·è¿›åº¦æ±‡æ€»è§†å›¾
- [ ] ä¼˜åŒ–ä»£ç ç¼–è¾‘å™¨è‡ªåŠ¨ä¿å­˜
- [ ] ä¼˜åŒ– Shader ç¼–è¯‘é€»è¾‘

### Phase 3: ç”¨æˆ·ä½“éªŒï¼ˆ3-4 å‘¨ï¼‰
- [ ] æ•™ç¨‹è¿›åº¦å¯è§†åŒ–
- [ ] å­¦ä¹ è·¯å¾„å¯è§†åŒ–
- [ ] å‹å¥½çš„é”™è¯¯æç¤º
- [ ] ä»£ç ç‰‡æ®µå¿«é€Ÿæ’å…¥

### Phase 4: ä»£ç è´¨é‡ï¼ˆ2 å‘¨ï¼‰
- [ ] å®Œå–„ç±»å‹å®šä¹‰
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†
- [ ] å¯ç”¨ä¸¥æ ¼ TypeScript é…ç½®

### Phase 5: å®‰å…¨æ€§ï¼ˆ1-2 å‘¨ï¼‰
- [ ] å¯ç”¨å¯†ç æ³„éœ²ä¿æŠ¤
- [ ] æ·»åŠ  CSP å¤´éƒ¨
- [ ] å®ç°é€Ÿç‡é™åˆ¶

### Phase 6: åŠŸèƒ½å¢å¼ºï¼ˆ2 å‘¨ï¼‰
- [ ] æ•™ç¨‹æœç´¢åŠŸèƒ½

### Phase 7: ç›‘æ§ä¸åˆ†æï¼ˆæŒç»­ï¼‰
- [ ] é”™è¯¯è¿½è¸ªç³»ç»Ÿ
- [ ] æ•™ç¨‹è´¨é‡ç›‘æ§

### Phase 8: UI/UX æ”¹è¿›ï¼ˆ1-2 å‘¨ï¼‰
- [ ] å“åº”å¼è®¾è®¡ä¼˜åŒ–

**æ€»é¢„è®¡æ—¶é—´**: 11-15 å‘¨

---

## ğŸ“ æŠ€æœ¯å€ºåŠ¡

### é«˜ä¼˜å…ˆçº§
1. **ç±»å‹å®‰å…¨**: ç§»é™¤æ‰€æœ‰ `any` ç±»å‹ï¼Œå®Œå–„ç±»å‹å®šä¹‰
2. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿè¯»å–ï¼Œæ·»åŠ ç¼“å­˜

### ä¸­ä¼˜å…ˆçº§
4. **æµ‹è¯•è¦†ç›–**: æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
5. **æ–‡æ¡£å®Œå–„**: API æ–‡æ¡£ã€ç»„ä»¶æ–‡æ¡£
6. **ä»£ç é‡æ„**: ç§»é™¤é‡å¤ä»£ç ï¼Œæå–å…¬å…±ç»„ä»¶

### ä½ä¼˜å…ˆçº§
7. **å›½é™…åŒ–æ‰©å±•**: æ”¯æŒæ›´å¤šè¯­è¨€
8. **è¾…åŠ©åŠŸèƒ½**: æé«˜æ— éšœç¢è®¿é—®æ€§
9. **SEO ä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–æœç´¢å¼•æ“æ’å

---

## ğŸš« å·²ç§»é™¤çš„åŠŸèƒ½ï¼ˆä¸å¼€å‘ï¼‰

ä»¥ä¸‹åŠŸèƒ½å·²ä» v2 è®¡åˆ’ä¸­ç§»é™¤ï¼š

1. **ä»£ç åˆ†äº«åŠŸèƒ½** - ä¸éœ€è¦ç¤¾äº¤åˆ†äº«ç‰¹æ€§
2. **æˆå°±ç³»ç»Ÿ** - ä¸éœ€è¦æ¸¸æˆåŒ–å…ƒç´ 
3. **PWA ç¦»çº¿æ”¯æŒ** - æš‚ä¸æ”¯æŒç¦»çº¿ä½¿ç”¨
4. **ç”¨æˆ·è¡Œä¸ºåˆ†æ** - ä¸éœ€è¦è¯¦ç»†çš„ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
5. **æš—è‰²æ¨¡å¼** - æš‚ä¸æ”¯æŒä¸»é¢˜åˆ‡æ¢

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æŒ‡å—](../CLAUDE.md)
- [README](../README.md)
- [è®¢é˜…ç³»ç»Ÿå®æ–½æ–¹æ¡ˆ](./SUBSCRIPTION_IMPLEMENTATION_PLAN.md)
- [æ•°æ®åº“è¿ç§»å®ŒæˆæŠ¥å‘Š](./DATABASE_MIGRATION_COMPLETED.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1
**æœ€åæ›´æ–°**: 2025-12-03
**ç»´æŠ¤è€…**: Claude Code
